steps:
# Set up authentication with the service account key
- name: "gcr.io/google.com/cloudsdktool/cloud-sdk"
  entrypoint: "bash"
  args:
  - "-c"
  - |
    echo "Activating service account"
    gcloud auth activate-service-account --key-file=$$GOOGLE_APPLICATION_CREDENTIALS

# Build using buildpacks
- name: "gcr.io/k8s-skaffold/pack"
  entrypoint: "pack"
  args:
  - "build"
  - "gcr.io/ai-qr-genius/thefmsmkt-pos:$COMMIT_SHA"
  - "--builder=gcr.io/buildpacks/builder"
  - "--publish"

# Deploy to Cloud Run
- name: "gcr.io/google.com/cloudsdktool/cloud-sdk"
  entrypoint: gcloud
  args:
  - "run"
  - "deploy"
  - "thefmsmkt-pos"
  - "--image=gcr.io/ai-qr-genius/thefmsmkt-pos:$COMMIT_SHA"
  - "--region=us-central1"
  - "--platform=managed"
  - "--allow-unauthenticated"

images:
- "gcr.io/ai-qr-genius/thefmsmkt-pos:$COMMIT_SHA"

options:
  logging: CLOUD_LOGGING_ONLY
  env:
  - "GOOGLE_APPLICATION_CREDENTIALS=../../Desktop/ai-qr-genius-43744b7f346b.json"
